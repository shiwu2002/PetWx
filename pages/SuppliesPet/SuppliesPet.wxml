<!--pages/SuppliesPet/SuppliesPet.wxml-->
<view class="container">
  <view wx:if="{{loading && suppliesList.length === 0}}" class="loading">åŠ è½½ä¸­...</view>
  <view wx:if="{{error && suppliesList.length === 0}}" class="error">åŠ è½½å¤±è´¥ï¼Œè¯·ä¸‹æ‹‰é‡è¯•</view>
  <view wx:if="{{suppliesList.length === 0 && !loading && !error}}" class="empty">æš‚æ— å•†å“</view>
  <block wx:for="{{suppliesList}}" wx:key="id">
    <view class="supply-item">
      <image class="supply-img" src="{{item.imageUrl}}" mode="aspectFill" />
      <view class="card-content">
        <view class="supply-main-row">
          <text class="supply-name">{{item.productName}}</text>
          <text class="supply-category">{{item.category}}</text>
          <text wx:if="{{item.isHot == 1}}" class="supply-hot">çƒ­é”€</text>
        </view>
        <view class="supply-meta-row">
          <text class="supply-brand">å“ç‰Œï¼š{{item.brand}}</text>
          <view class="like-section" catchtap="toggleLike" data-target-id="{{item.id}}">
            <view class="like-icon {{likeStates[item.id] ? 'liked' : ''}}">
              {{likeStates[item.id] ? 'â¤ï¸' : 'ğŸ¤'}}
            </view>
            <view class="like-count">{{likeCounts[item.id] || 0}}</view>
          </view>
        </view>
        <view class="supply-desc-block">
          <text class="supply-desc">{{item.description}}</text>
        </view>
        <view class="supply-price-row">
          <text class="supply-price">ï¿¥{{item.price}}</text>
          <text class="supply-stock">åº“å­˜: {{item.stockQuantity}}</text>
        </view>
        <view class="action-container">
          <button class="cart-btn" data-supply="{{item}}" bindtap="showAddToCartPopup">åŠ å…¥è´­ç‰©è½¦</button>
          <button class="detail-btn" data-id="{{item.id}}" bindtap="goToDetail">æŸ¥çœ‹è¯¦æƒ…</button>
        </view>
      </view>
    </view>
  </block>
  <!-- åŠ è½½æ›´å¤šæç¤º -->
  <view wx:if="{{loading && suppliesList.length > 0}}" class="loading-more">åŠ è½½ä¸­...</view>
  <view wx:if="{{!hasMore && suppliesList.length > 0}}" class="no-more">æ²¡æœ‰æ›´å¤šäº†</view>
  
  <!-- è´­ç‰©è½¦å¼¹çª— -->
  <view wx:if="{{showCartPopup}}" class="buy-popup-mask">
    <view class="buy-popup">
      <view class="buy-popup-title">åŠ å…¥è´­ç‰©è½¦ - {{selectedSupply.productName}}</view>
      <input class="buy-popup-input" type="number" min="1" max="{{selectedSupply.stockQuantity}}" value="{{cartNum}}" bindinput="onCartNumInput" />
      <view class="buy-popup-actions">
        <button class="buy-popup-cancel" bindtap="onCloseCartPopup">å–æ¶ˆ</button>
        <button class="buy-popup-confirm" bindtap="onConfirmAddToCart">ç¡®è®¤åŠ å…¥</button>
      </view>
    </view>
  </view>
</view>