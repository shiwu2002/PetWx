<!--pages/SuppliesPet/SuppliesPet.wxml-->
<view class="container">
  <view wx:if="{{loading && suppliesList.length === 0}}" class="loading">加载中...</view>
  <view wx:if="{{error && suppliesList.length === 0}}" class="error">加载失败，请下拉重试</view>
  <view wx:if="{{suppliesList.length === 0 && !loading && !error}}" class="empty">暂无商品</view>
  <block wx:for="{{suppliesList}}" wx:key="id">
    <view class="supply-item">
      <image class="supply-img" src="{{item.imageUrl}}" mode="aspectFill" />
      <view class="card-content">
        <view class="supply-main-row">
          <text class="supply-name">{{item.productName}}</text>
          <text class="supply-category">{{item.category}}</text>
          <text wx:if="{{item.isHot == 1}}" class="supply-hot">热销</text>
        </view>
        <view class="supply-meta-row">
          <text class="supply-brand">品牌：{{item.brand}}</text>
          <view class="like-section" catchtap="toggleLike" data-target-id="{{item.id}}">
            <view class="like-icon {{likeStates[item.id] ? 'liked' : ''}}">
              {{likeStates[item.id] ? '❤️' : '🤍'}}
            </view>
            <view class="like-count">{{likeCounts[item.id] || 0}}</view>
          </view>
        </view>
        <view class="supply-desc-block">
          <text class="supply-desc">{{item.description}}</text>
        </view>
        <view class="supply-price-row">
          <text class="supply-price">￥{{item.price}}</text>
          <text class="supply-stock">库存: {{item.stockQuantity}}</text>
        </view>
        <view class="action-container">
          <button class="cart-btn" data-supply="{{item}}" bindtap="showAddToCartPopup">加入购物车</button>
          <button class="detail-btn" data-id="{{item.id}}" bindtap="goToDetail">查看详情</button>
        </view>
      </view>
    </view>
  </block>
  <!-- 加载更多提示 -->
  <view wx:if="{{loading && suppliesList.length > 0}}" class="loading-more">加载中...</view>
  <view wx:if="{{!hasMore && suppliesList.length > 0}}" class="no-more">没有更多了</view>
  
  <!-- 购物车弹窗 -->
  <view wx:if="{{showCartPopup}}" class="buy-popup-mask">
    <view class="buy-popup">
      <view class="buy-popup-title">加入购物车 - {{selectedSupply.productName}}</view>
      <input class="buy-popup-input" type="number" min="1" max="{{selectedSupply.stockQuantity}}" value="{{cartNum}}" bindinput="onCartNumInput" />
      <view class="buy-popup-actions">
        <button class="buy-popup-cancel" bindtap="onCloseCartPopup">取消</button>
        <button class="buy-popup-confirm" bindtap="onConfirmAddToCart">确认加入</button>
      </view>
    </view>
  </view>
</view>