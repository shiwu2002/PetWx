<view class="main-container side-layout">
  <!-- å·¦ä¾§å¯¼èˆªæ  -->
  <view class="side-nav">
    <view class="nav-header">
      <text class="nav-title">ä¸ªäººä¸­å¿ƒ</text>
      <text class="nav-subtitle">ç®¡ç†æ‚¨çš„è´¦æˆ·</text>
    </view>
    <view class="nav-list">
      <block wx:for="{{sideNavList}}" wx:key="key">
        <view class="side-nav-item" data-nav="{{item.key}}" bindtap="onSelectNav" wx:class="{active: selectedNav === item.key}">
          <view class="nav-icon">{{item.icon || 'ğŸ“‹'}}</view>
          <text class="nav-label">{{item.label}}</text>
        </view>
      </block>
    </view>
    <view class="nav-footer">
      <view class="logout-btn" bindtap="onLogout">
        <view class="nav-icon">ğŸšª</view>
        <text class="nav-label">é€€å‡ºç™»å½•</text>
      </view>
    </view>
  </view>

  <!-- å³ä¾§å†…å®¹åŒº -->
  <view class="side-content">
    <!-- ä¸ªäººä¿¡æ¯å†…å®¹ -->
    <block wx:if="{{selectedNav === 'profile'}}">
      <view class="content-header">
        <text class="content-title">ä¸ªäººä¿¡æ¯</text>
      </view>
      
      <view class="user-profile-card">
        <view class="profile-header">
          <view class="avatar-section">
            <image class="avatar" src="{{userInfo.avatarUrl || '/components/IMAGES/Discover.png'}}" mode="aspectFill" bindtap="onChooseAvatar"/>
          </view>
          <view class="user-info">
            <text class="nickname">{{userInfo.nickName || 'æœªç™»å½•'}}</text>
            <text class="phone">{{userInfo.phone || 'æœªç»‘å®šæ‰‹æœºå·'}}</text>
            <button class="edit-profile-btn" bindtap="editProfile">
              <text class="btn-text">ç¼–è¾‘èµ„æ–™</text>
            </button>
          </view>
        </view>
        
        <view class="profile-details">
          <view class="detail-row">
            <text class="detail-label">ç”¨æˆ·å</text>
            <text class="detail-value">{{userInfo.username || 'æœªè®¾ç½®'}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">è´¦æˆ·ä½™é¢</text>
            <text class="detail-value balance">{{userInfo.money !== '' ? userInfo.money : '0'}} å…ƒ</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">ä¿¡ç”¨è¯„åˆ†</text>
            <text class="detail-value credit">{{userInfo.credit_score !== '' ? userInfo.credit_score : '0'}}</text>
          </view>
        </view>
        
        <view class="profile-actions">
          <button class="action-btn primary" bindtap="contactService">
            <text class="btn-icon">ğŸ’¬</text>
            <text class="btn-text">è”ç³»å®¢æœ</text>
          </button>
        </view>
      </view>
    </block>

    <!-- æˆ‘çš„ç”³è¯·å†…å®¹ -->
    <block wx:if="{{selectedNav === 'myApply'}}">
      <view class="content-header">
        <text class="content-title">æˆ‘çš„ç”³è¯·</text>
        <text class="content-subtitle">æŸ¥çœ‹æ‚¨çš„é¢†å…»ç”³è¯·çŠ¶æ€</text>
      </view>
      
      <view wx:if="{{loading}}" class="loading-state">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      
      <view wx:elif="{{error}}" class="error-state">
        <view class="error-icon">âš ï¸</view>
        <text class="error-text">{{error}}</text>
        <button class="retry-btn" bindtap="loadApplyData">
          <text class="btn-text">é‡è¯•</text>
        </button>
      </view>
      
      <block wx:elif="{{applyData && applyData.length}}">
        <view class="apply-list">
          <block wx:for="{{applyData}}" wx:key="id">
            <view class="apply-card">
              <view class="card-header">
                <image class="pet-image" src="{{applyDataPreviewUrls[index]}}" mode="aspectFill"/>
                <view class="pet-info">
                  <text class="pet-name">{{item.petName}}</text>
                  <view class="status-badge" data-status="{{item.status}}">
                    <text class="status-text">{{item.status}}</text>
                  </view>
                </view>
              </view>
              
              <view class="card-content">
                <view class="info-section">
                  <text class="section-title">å® ç‰©ä¿¡æ¯</text>
                  <view class="info-grid">
                    <view class="info-item">
                      <text class="info-label">å“ç§</text>
                      <text class="info-value">{{item.petBreed}}</text>
                    </view>
                    <view class="info-item">
                      <text class="info-label">å¹´é¾„</text>
                      <text class="info-value">{{item.petAge}}</text>
                    </view>
                    <view class="info-item">
                      <text class="info-label">æ€§åˆ«</text>
                      <text class="info-value">{{item.petGender}}</text>
                    </view>
                    <view class="info-item">
                      <text class="info-label">å¥åº·çŠ¶å†µ</text>
                      <text class="info-value">{{item.petHealthStatus}}</text>
                    </view>
                  </view>
                </view>
                
                <view class="info-section">
                  <text class="section-title">ç”³è¯·ä¿¡æ¯</text>
                  <view class="info-grid">
                    <view class="info-item">
                      <text class="info-label">ç”³è¯·äºº</text>
                      <text class="info-value">{{item.userNickname}}</text>
                    </view>
                    <view class="info-item full-width">
                      <text class="info-label">ç”³è¯·ç†ç”±</text>
                      <text class="info-value">{{item.applyReason}}</text>
                    </view>
                    <view class="info-item full-width">
                      <text class="info-label">å…»å® ç»éªŒ</text>
                      <text class="info-value">{{item.petExperience}}</text>
                    </view>
                  </view>
                </view>
              </view>
              
              <view class="card-actions">
                <button class="view-task-btn" data-applyid="{{item.id}}" bindtap="onViewTask">
                  <text class="btn-icon">ğŸ“‹</text>
                  <text class="btn-text">æŸ¥çœ‹å®¶è®¿ä»»åŠ¡</text>
                </button>
              </view>
            </view>
          </block>
        </view>
      </block>
      
      <view wx:else class="empty-state">
        <view class="empty-icon">ğŸ“</view>
        <text class="empty-text">æš‚æ— ç”³è¯·æ•°æ®</text>
        <text class="empty-desc">æ‚¨è¿˜æ²¡æœ‰æäº¤è¿‡é¢†å…»ç”³è¯·</text>
      </view>
    </block>

    <!-- æ•‘åŠ©ä¿¡æ¯å†…å®¹ -->
    <block wx:if="{{selectedNav === 'myDiscover'}}">
      <view class="content-header">
        <text class="content-title">æˆ‘çš„æ•‘åŠ©</text>
        <text class="content-subtitle">æŸ¥çœ‹æ‚¨å‘å¸ƒçš„æ•‘åŠ©ä¿¡æ¯</text>
      </view>
      
      <view wx:if="{{myDiscoverData.length === 0}}" class="empty-state">
        <view class="empty-icon">ğŸ¾</view>
        <text class="empty-text">æš‚æ— æ•‘åŠ©ä¿¡æ¯</text>
        <text class="empty-desc">æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒè¿‡æ•‘åŠ©ä¿¡æ¯</text>
      </view>
      
      <block wx:for="{{myDiscoverData}}" wx:key="id">
        <view class="discover-card">
          <view class="discover-header">
            <view class="discover-badges">
              <view class="badge type-badge">
                <text class="badge-text">{{item.animalType}}</text>
              </view>
              <view class="badge status-badge" data-status="{{item.status}}">
                <text class="badge-text">{{item.status}}</text>
              </view>
            </view>
          </view>
          
          <view class="discover-content">
            <text class="discover-desc">{{item.description}}</text>
            <view class="discover-location">
              <text class="location-icon">ğŸ“</text>
              <text class="location-text">{{item.location}}</text>
            </view>
          </view>
          
          <view class="discover-images" wx:if="{{myDiscoverPreviewUrls[index] && myDiscoverPreviewUrls[index].length > 0}}">
            <block wx:for="{{myDiscoverPreviewUrls[index]}}" wx:key="*this">
              <image class="discover-img" src="{{item}}" mode="aspectFill" lazy-load="true" show-menu-by-longpress="true" binderror="onImageError" data-original-src="{{item}}" />
            </block>
          </view>
        </view>
      </block>
    </block>

    <!-- è¡¥å……ä¿¡æ¯å¼¹çª— -->
    <view wx:if="{{showEditModal}}" class="modal-mask" bindtap="closeEditModal">
      <view class="modal" catchtap="stopPropagation">
        <view class="modal-header">
          <text class="modal-title">ç¼–è¾‘ä¸ªäººä¿¡æ¯</text>
          <view class="modal-close" bindtap="closeEditModal">Ã—</view>
        </view>
        
        <view class="modal-body">
          <view class="input-group">
            <text class="input-label">æ˜µç§°</text>
            <input class="modal-input" placeholder="è¯·è¾“å…¥æ˜µç§°" value="{{editNickName}}" bindinput="onEditNickName" />
          </view>
          
          <view class="input-group">
            <text class="input-label">æ‰‹æœºå·</text>
            <input class="modal-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="{{editPhone}}" bindinput="onEditPhone" />
          </view>
        </view>
        
        <view class="modal-actions">
          <button class="modal-btn cancel" bindtap="closeEditModal">å–æ¶ˆ</button>
          <button class="modal-btn primary" bindtap="saveProfile">ä¿å­˜</button>
        </view>
      </view>
    </view>

    <!-- æˆ‘çš„å–œæ¬¢å†…å®¹ -->
    <block wx:if="{{selectedNav === 'myLike'}}">
      <view class="content-header">
        <text class="content-title">æˆ‘çš„å–œæ¬¢</text>
      </view>
      
      <view wx:if="{{loading}}" class="loading-state">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      
      <view wx:elif="{{error}}" class="error-state">
        <view class="error-icon">âš ï¸</view>
        <text class="error-text">è·å–å–œæ¬¢åˆ—è¡¨å¤±è´¥</text>
        <button class="retry-btn" bindtap="loadUserLikes">
          <text class="btn-text">é‡è¯•</text>
        </button>
      </view>
      
      <block wx:elif="{{likeList && likeList.length > 0}}">
        <view class="like-list">
          <block wx:for="{{likeList}}" wx:key="id">
            <view class="like-card" bindtap="navigateToDetail" data-type="{{item.targetType}}" data-id="{{item.targetId}}">
              <view class="card-header">
                <image class="card-image" src="{{item.imageUrl}}" mode="aspectFill" lazy-load="true"/>
                <view class="card-info">
                  <text class="card-title">{{item.title}}</text>
                  <view class="card-type-badge" data-type="{{item.targetType}}">
                    <text class="badge-text">{{item.displayType}}</text>
                  </view>
                  <view class="card-subtitle">
                    <text class="subtitle-text">{{item.subtitle}}</text>
                  </view>
                </view>
              </view>
              
              <view class="card-content">
                <view class="card-extra-info">
                  <text class="extra-info-text">{{item.extraInfo}}</text>
                </view>
                
                <view class="card-footer">
                  <view class="card-time">
                    <text class="time-icon">ğŸ“…</text>
                    <text class="time-text"> {{item.createTime}}</text>
                  </view>
                  <view class="card-action">
                    <text class="action-text">ç‚¹å‡»æŸ¥çœ‹</text>
                    <text class="action-arrow">â€º</text>
                  </view>
                </view>
              </view>
            </view>
          </block>
        </view>
      </block>
      
      <view wx:else class="empty-state">
        <view class="empty-icon">â¤ï¸</view>
        <text class="empty-text">æš‚æ— å–œæ¬¢çš„å†…å®¹</text>
        <text class="empty-desc">å¿«å»æµè§ˆå¹¶æ”¶è—å–œæ¬¢çš„å® ç‰©æˆ–ç”¨å“å§~</text>
      </view>
    </block>
  </view>
</view>